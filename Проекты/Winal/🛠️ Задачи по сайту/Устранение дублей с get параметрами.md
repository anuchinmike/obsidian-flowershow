---
title: Устранение дублей с get параметрами
created: 2025-07-23
modified: 2025-08-10
status: completed
tags:
  - winal
  - winal-задачи-сайт
  - winal-техническое-обслуживание
aliases:
---

## Формулировка проблемы

Поисковые системы (Яндекс, Google) фиксировали дубликаты страниц, отличающиеся только рекламными и служебными GET‑параметрами (utm, gclid, yclid, fbclid, и т.п.). Это размывало краулинговый бюджет и портило отчёты по индексации.

## Что сделали

1. Заблокировали индексацию «мусорных» параметров в `robots.txt` (на уровне рекомендаций для роботов):

- utm_source/medium/campaign/term/content, gclid, yclid, fbclid, msclkid и др.
- служебные: ref, source, medium, campaign, sm_pkey, \_ga, \_gl, v, ver и др.

2. Включили принудительную очистку URL на сайте (уровень сайта, обязательно для всех):

- На этапe `template_redirect` выполняем автоматический 301‑редирект со страницы с параметрами на «чистый» канонический URL.
- Перед редиректом параметры читаются и сохраняются в cookies (для аналитики и отправки в CRM), чтобы бизнес‑метрики не потерялись.
- Исключения: админка, AJAX, REST, предпросмотр.

3. Каноникал и SEO:

- В Rank Math SEO включены стандартные канонические ссылки на чистые URL.
- Sitemap ссылается только на канонические URL без рекламных хвостов.

4. Проверка кэша:

- Настройки W3 Total Cache не кэшируют страницы админки/поиска/превью, что исключает «залипание» мусорных адресов.

## Где реализовано

- Стейджинг: `winal.magency.su/wp-content/themes/winal/functions.php` — блок редиректа 301 для рекламных GET‑параметров; установка UTM‑cookies.
- Продакшн: `winal.ru/public_html/wp-content/themes/winal/functions.php` — тот же блок редиректа 301; UTM‑cookies.
- `robots.txt` — обновлён, список параметров заблокирован от индексации.

## Список параметров

utm_source, utm_medium, utm_campaign, utm_term, utm_content, gclid, yclid, fbclid, msclkid, ref, source, campaign, medium, sm_pkey, \_ga, \_gl, v, ver, mc_eid, \_ke, а также выявленные на проекте: `eltext`, `mango`.

## Тест‑кейсы

- Вход по ссылке с UTM/yclid/gclid → через 301 редирект попадаем на тот же путь без параметров, значения сохранены в cookies, формы и CRM получают UTM/клики.
- «Голая» страница без параметров → остаётся без редиректа.
- Предпросмотр, админка, REST/AJAX → редиректа нет.

## Результат

- Новые дубли больше не попадают в индекс (URL нормализуются редиректом).
- Старые дубли будут постепенно вычищены: по опыту Яндекса 3–14 дней (зависит от частоты обхода страниц).
- Бизнес‑метки (UTM/yclid/gclid) не теряются — сохраняются в cookies и передаются в CRM.

## Примечания

- Если в будущем появятся новые служебные параметры на сайте, их можно добавить в список для редиректа без правки `robots.txt`.
- При необходимости исключим из редиректа «рабочие» параметры внутренних фильтров (не используются сейчас).

![[Pasted image 20250723131235.png]]

![[Pasted image 20250723131313.png]]
